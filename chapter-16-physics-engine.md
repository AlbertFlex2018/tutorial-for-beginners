# 物理引擎

## 牛顿的苹果

长久以来，哲学领域有一个争论不休的话题，就是这个世界有没有独立意志？

有一种观点认为世界是有意志的，但是它的意志与人的表现形式不同。天道无私，对世间万物并无任何偏爱。另一种观点认为世界是无意识的，它的背后并无一个主宰来决定应该怎么做，只是按照大道规则自然运转。事实上这是一个无法证伪的问题，因为具有独立意志，就意味着不需要任何外在来证明其存在。

这个问题只对思考它的人有意义，最终取决于人们如何与世界相处。世界孕育了各种生灵，其中人类天生便开启了灵智。如果我们有意识，那这个孕育了我们的世界呢？

汉语中有个话说得很有意思，叫做**“采天地之灵气，吸日月之精华”**。很多人幻想世界上有种看不见摸不着的“灵气”或“能量”，要在风水好的地方才能吸收到，吸收这种“灵气”可以达到改造体质的目的。这都是胡扯。**其实天地真正的精华是什么？是万物自然运行的规律。**成语**“仰观俯察”**出自《易经·系辞》，原文是**“仰以观于天文，俯以察于地理，是故知幽明之故。”**意思是把世界当做我们的老师。人类的诸多科技文明，都是从世界中学来的，代代积累传承至今。

还有一个很有趣的词，叫做**“天心”**。天有心吗？我不知道，我只知道人有心。所谓**体悟天心**，其实是以人心感悟天道。你到底悟没悟，悟出了什么，谁也看不出来。好在中国人从来都不太在意这些虚无缥缈的东西，我们只关心**天心神用**。什么叫“天心神用”？徐公子胜治曾在其小说[《神游》](http://book.qidian.com/info/65875)中描述了一番非常经典的问论：**何者为神？用者为神。何者为用？当者为用。**那么这句话翻译过来的意思就是：什么是神？就是为了用。就好比一瓶水，我要用的就是它能充润于我，我口渴的时候它能喝，我不渴的时候它也可有可无。这就是“用者为神”。它的实用就是滋养一个人，充润一个人。我口渴了，解渴只需要一瓶水就够。一滴水不够，一桶水太多，太多太少都不恰当，不恰当的那就是“祸”了。只有恰当才称得上是“用”，这就是“当者为用”。

一个人从诞生的那一刻起，就拥有了整个世界，并且无时无刻不在吸收天地的精华。无论你是否在意，天地都将这一切赋予了你。所以玩游戏时，如果你操纵的角色直接从平地上掉出了世界，你就会非常鄙视这款游戏的开发者，因为这违背了常识。到底什么是常识？常识就是道，大道常常隐藏在平凡的事物当中。每个人对世界的规律都有自己的认知，但是少有人能把它总结成规律。人人都知道苹果熟了会掉到地上，只有牛顿这样的人才会总掉落的苹果身上看到万有引力定律。

现在，你是游戏的开发者，**你正在创造一个世界。**这个世界有意志吗？游戏本身是没有意志的，但开发游戏的你有意志，将来玩这个游戏的人也有意志。你是这个游戏的主宰，可以让这个世界表现出更加接近现实世界的规律，或者只符合你定下的规则。无论如何，你需要一个规则来运转这个世界。我们用类和对象来抽象自己对世界的理解，并用代码逻辑来描述世界的规律，越是接近现实规律，程序就越是复杂。并不是每个人都能用代码实现苹果落地的过程，物理引擎将使你最好的帮手。

## 物理引擎概述

物理引擎是一种用于模拟真实物理现象的中间件，可以用来创建虚拟的物理环境，并在其中运行来自物理世界的规则。物理引擎应用的最多的地方就是动画和游戏行业，例如3D游戏开发有三大知名物理引擎：

* [PhysX （NVIDIA公司）](http://www.nvidia.cn/object/physx_new_cn.html)
* [Havok （Intel公司）](http://www.havok.com/)
* [Bullet （AMD公司）](http://bulletphysics.org/wordpress/)

Bullet物理引擎是一款开源、免费的物理引擎，jMonkeyEngine3 选择了与Bullet引擎集成。PhysX虽然现在不开源，但也实行免费推广政策，是Unity3D、CryEngine等游戏引擎的首选。Hovak引擎的授权则比较昂贵和严格，光环4、上古卷轴5等游戏大作使用的都是这款引擎。据说暴雪在开发暗黑破坏神时曾使用这个引擎，不过后来改用自研的物理引擎了（可能是因为Hovak太贵？）。这三大物理引擎都有很多游戏大作，网上有很多关于它们的介绍和对比，所以本文就不再赘述了，感兴趣的读者可以自行探索。

顺便提一下2D物理引擎，应用最广泛的2D物理引擎当属[Box2D](https://github.com/erincatto/Box2D)，以及它的衍生项目 Chipmunk。cocos 2d、libGDX等2D游戏引擎中默认集成的就是Box2D。Java世界中也有一些比较出色的作品，比如[Dyn4j](https://github.com/wnbittle/dyn4j)。

除这些知名物理引擎以外，还有其他数不清的物理引擎，使用各种语言开发的都有（Java、C#、JavaScript、Python……）。我并不想对这些引擎都一一介绍，但是想在此讨论一些这些物理引擎的共性，即它们背后的物理规则。

### 理论力学

如同3D图形引擎是建立在**计算机图形学**和**光学建模**的理论基础大厦之上，现代物理引擎也有其理论根基，最主要的就是物理学的分支——**理论力学**。

**理论力学（theoretical mechanics）**是研究物体机械运动的基本规律的学科，是力学的一个分支。它是大部分工程技术科学的基础，也称**经典力学**。其理论基础是**牛顿运动定律**。20世纪初建立起来的量子力学和相对论，表明牛顿力学所表述的是相对论力学在物体速度远小于光速时的极限情况，也是量子力学在量子数为无限大时的极限情况。对于速度远小于光速的宏观物体的运动，包括超音速喷气飞机及宇宙飞行器的运动，都可以用经典力学进行分析 。

理论力学通常分为三个部分：静力学、运动学与动力学。**静力学（statics）**研究作用于物体上的力系的简化理论及力系平衡条件；**运动学（kinematics）**只从几何角度研究物体机械运动特性而不涉及物体的受力；**动力学（dynamics）**则研究物体机械运动与受力的关系。动力学是理论力学的核心内容。理论力学的研究方法是从一些由经验或实验归纳出的反映客观规律的基本公理或定律出发，经过数学演绎得出物体机械运动在一般情况下的规律及具体问题中的特征。理论力学中的物体主要指**质点**、**刚体**及**刚体系**，当物体的变形不能忽略时，则成为**变形体力学（如材料力学、弹性力学等）**的讨论对象。静力学与动力学是工程力学的主要部分。

质点和刚体的运动是游戏物理引擎中运用最多的技术，因为刚体在发生碰撞时可以忽略物体的形态变化。对于需要实时运算的游戏来说，这意味着只需要针对质点的运动进行模拟，可以极大得简化模拟过程。比刚体更为复杂的是软体，例如布娃娃、弹球、布料等物体，在发生碰撞后会导致模型变形。在游戏中，这种变形通常意味着需要实时计算成千上万个顶点的位置。

### 与游戏的集成



## Bullet物理引擎
1 Bullet的物理空间
2 刚体碰撞
3 创建一个胶囊体
4控制模型在地图中走动
## Dyn4j

